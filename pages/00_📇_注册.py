from datetime import datetime, timedelta, timezone
from pathlib import Path

import pytz
import streamlit as st
from cryptography.fernet import Fernet
from google.cloud.firestore import FieldFilter

from gailib.auth_utils import is_valid_email, is_valid_phone_number
from gailib.constants import CEFR_LEVEL_MAPS, FAKE_EMAIL_DOMAIN, PROVINCES
from gailib.db_interface import DbInterface
from gailib.db_model import User
from gailib.st_helper import add_exercises_to_db, on_project_changed
from gailib.word_utils import get_voice_styles
from menu import menu

# åˆ›å»º Fernet å®ä¾‹ã€å¿…é¡»å°†keyè½¬æ¢ä¸ºbytesç±»å‹ã€‘
# fernet = Fernet(st.secrets["FERNET_KEY"].encode())
CURRENT_CWD: Path = Path(__file__).parent.parent
VOICES_DIR = CURRENT_CWD / "resource/voices"

st.set_page_config(
    page_title="ç”¨æˆ·ç®¡ç†",
    page_icon=":bust_in_silhouette:",
    layout="wide",
)

menu()

on_project_changed("ç”¨æˆ·æ³¨å†Œ")
add_exercises_to_db()


# region ä¾§è¾¹æ 

sidebar_status = st.sidebar.empty()


# endregion

# region åˆ›å»ºæ³¨å†Œé¡µé¢

st.subheader(":bust_in_silhouette: ç”¨æˆ·æ³¨å†Œ", anchor="ç”¨æˆ·æ³¨å†Œ")

# with st.form(key="registration_form", clear_on_submit=True):
with st.form(key="registration_form"):
    col1, col2 = st.columns(2)
    phone_number = col1.text_input(
        "æ‰‹æœºå·ç ",
        key="phone_number",
        help="âœ¨ è¯·è¾“å…¥æœ‰æ•ˆæ‰‹æœºå·ç ",
        placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ",
    )
    email = col2.text_input(
        "é‚®ç®±",
        key="email",
        help="âœ¨ è¯·è¾“å…¥æ‚¨å¸¸ç”¨çš„ç”µå­é‚®ä»¶åœ°å€",
        placeholder="è¯·è¾“å…¥ç”µå­é‚®ä»¶åœ°å€ï¼ˆå¯é€‰ï¼‰",
    )
    real_name = col1.text_input(
        "çœŸå®å§“å",
        key="real_name",
        help="âœ¨ è¯·è¾“å…¥æ‚¨åœ¨æˆç»©å†Œä¸Šçš„å§“åã€‚",
        placeholder="è¯·è¾“å…¥çœŸå®å§“åï¼ˆå¯é€‰ï¼‰",
    )
    display_name = col2.text_input(
        "æ˜¾ç¤ºåç§°",
        key="display_name",
        help="âœ¨ è¯·è¾“å…¥æ‚¨çš„ç™»å½•æ˜¾ç¤ºåç§°ã€‚",
        placeholder="è¯·è¾“å…¥æ˜¾ç¤ºåç§°",
    )
    current_level = col1.selectbox(
        "å½“å‰è‹±è¯­æ°´å¹³",
        CEFR_LEVEL_MAPS.keys(),
        index=0,
        key="current_level",
        help="âœ¨ è¯·é€‰æ‹©æ‚¨å½“å‰çš„è‹±è¯­æ°´å¹³ã€‚å¦‚æœæ‚¨ä¸äº†è§£å¦‚ä½•åˆ†çº§ï¼Œè¯·å‚é˜…å±å¹•ä¸‹æ–¹å…³äºCEFRåˆ†çº§çš„è¯´æ˜ã€‚",
    )
    target_level = col2.selectbox(
        "æœŸæœ›è¾¾åˆ°çš„è‹±è¯­æ°´å¹³",
        CEFR_LEVEL_MAPS.keys(),
        index=5,
        key="target_level",
        help="âœ¨ è¯·é€‰æ‹©æ‚¨æœŸæœ›è¾¾åˆ°çš„è‹±è¯­æ°´å¹³ã€‚å¦‚æœæ‚¨ä¸äº†è§£å¦‚ä½•åˆ†çº§ï¼Œè¯·å‚é˜…å±å¹•ä¸‹æ–¹å…³äºCEFRåˆ†çº§çš„è¯´æ˜ã€‚",
    )
    country = col1.selectbox(
        "æ‰€åœ¨å›½å®¶",
        ["ä¸­å›½"],
        index=0,
        key="country",
    )
    province = col2.selectbox("æ‰€åœ¨çœä»½", PROVINCES, index=0, key="province")
    password_reg = st.text_input(
        "å¯†ç ",
        type="password",
        key="password_reg",
        help="âœ¨ è¯·è¾“å…¥æ‚¨çš„å¯†ç ã€‚å¯†ç é•¿åº¦è‡³å°‘ä¸º8ä½ã€‚",
        placeholder="è¯·è¾“å…¥å¯†ç ï¼Œè‡³å°‘ä¸º8ä½",
    )
    password_reg_repeat = st.text_input(
        "å¯†ç ",
        type="password",
        key="password_reg_repeat",
        help="âœ¨ è¯·å†æ¬¡è¾“å…¥å¯†ç ä»¥ç¡®è®¤",
        placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ä»¥ç¡®è®¤",
    )
    tz = col1.selectbox(
        "æ‰€åœ¨æ—¶åŒº",
        pytz.common_timezones,
        index=pytz.common_timezones.index("Asia/Shanghai"),
        key="timezone",
        help="âœ¨ è¯·é€‰æ‹©æ‚¨å½“å‰æ‰€åœ¨çš„æ—¶åŒºã€‚å¦‚æœæ‚¨åœ¨ä¸­å›½ï¼Œè¯·ä½¿ç”¨é»˜è®¤å€¼ã€‚",
    )
    VOICES_STYLES = get_voice_styles("us") + get_voice_styles("gb")
    voice_style = col2.selectbox("è¯­éŸ³é£æ ¼", VOICES_STYLES, index=0, key="voice_style")
    agree = st.checkbox(
        "æˆ‘åŒæ„ã€ŠæœåŠ¡æ¡æ¬¾ã€‹",
        key="agree",
        value=False,
        help="âœ¨ è¯·ä»”ç»†é˜…è¯»å¹¶åŒæ„ã€ŠæœåŠ¡æ¡æ¬¾ã€‹ã€‚",
    )
    status = st.empty()
    if st.form_submit_button(label="æ³¨å†Œ"):
        if not agree:
            status.error("è¯·ä»”ç»†é˜…è¯»ã€ŠæœåŠ¡æ¡æ¬¾ã€‹ï¼Œå¹¶å‹¾é€‰åŒæ„ã€‚")
            st.stop()
        if not is_valid_phone_number(phone_number):
            status.error("å¿…é¡»è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ")
            st.stop()
        if not display_name:
            status.error("å¿…é¡»è¾“å…¥æœ‰æ•ˆçš„æ˜¾ç¤ºåç§°")
            st.stop()
        if not is_valid_email(email):
            # st.write(f"{email=}")
            status.warning(
                "ä¸ºäº†ç¡®ä¿æ‚¨èƒ½åŠæ—¶æ”¶åˆ°æœ€æ–°äº§å“ä¿¡æ¯ï¼Œè¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€ã€‚æ‚¨è¿˜å¯ä»¥ç¨ååœ¨â€œç”¨æˆ·ä¸­å¿ƒ-æ›´æ–°ä¿¡æ¯â€ä¸­æ·»åŠ é‚®ç®±ã€‚"
            )
        elif not is_valid_email(email):
            status.error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€")
            st.stop()
        if password_reg != password_reg_repeat:
            status.error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")
            st.stop()
        if len(password_reg) < 8:
            status.error("å¯†ç é•¿åº¦è‡³å°‘ä¸º8ä½")
            st.stop()

        # è™šæ‹Ÿé‚®ç®±
        email = email if email else f"{phone_number}@{FAKE_EMAIL_DOMAIN}"
        # st.write(f"{tz=}")
        user = User(
            email=email,
            real_name=real_name,
            country=country if country else None,
            province=province if province else None,
            timezone=tz if tz else None,
            phone_number=phone_number,
            current_level=current_level,
            target_level=target_level,
            display_name=display_name,
            password=password_reg,
            registration_time=datetime.now(timezone.utc),
            voice_style=voice_style,
        )  # type: ignore
        try:
            # æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨å…·æœ‰ç›¸åŒæ‰‹æœºå·ç æˆ–ç”µå­é‚®ä»¶çš„ç”¨æˆ·
            users_ref = st.session_state.dbi.db.collection("users")
            existing_user = users_ref.where(
                filter=FieldFilter("phone_number", "==", user.phone_number)
            ).get()
            if existing_user:
                raise ValueError("ç”µè¯å·ç å·²è¢«æ³¨å†Œ")
            existing_user = users_ref.where(
                filter=FieldFilter("email", "==", user.email)
            ).get()
            if existing_user:
                raise ValueError("é‚®ç®±å·²è¢«æ³¨å†Œ")

            # å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç°æœ‰çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ³¨å†Œæ–°ç”¨æˆ·
            st.session_state.dbi.register_user(user)
        except ValueError as e:
            msg = str(e)
            status.markdown(
                f"""
            **æ‚¨è¾“å…¥çš„{msg}ã€‚**
            å¦‚æœæ‚¨å·²å®Œæˆä»˜æ¬¾ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ‚¨æ³¨å†Œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç›´æ¥ç™»å½•ï¼š
            1. åœ¨å·¦ä¾§èœå•â€œç”¨æˆ·ä¸­å¿ƒâ€çš„â€œç™»å½•â€é€‰é¡¹ï¼Œè¾“å…¥æ‚¨å·²æ³¨å†Œçš„æ‰‹æœºå·ç ã€‚
            2. è¾“å…¥é»˜è®¤å¯†ç ï¼šæ‚¨çš„æ‰‹æœºå·ç ã€‚
            3. ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ã€‚
            ç™»å½•æˆåŠŸåï¼Œæ‚¨å¯ä»¥åœ¨â€œç”¨æˆ·ä¸­å¿ƒâ€ä¿®æ”¹ä¸ªäººä¿¡æ¯ã€‚"""
            )
            st.stop()
        # æˆªè‡³ä»˜æ¬¾æœŸé™
        deadline = datetime.now(timezone.utc) + timedelta(days=3)
        # åˆ›å»ºä¸€ä¸ªæ—¶åŒºå¯¹è±¡
        tz = pytz.timezone(tz)
        # å°† UTC æ—¶é—´è½¬æ¢ä¸ºç‰¹å®šçš„æ—¶åŒº
        deadline = deadline.astimezone(tz)
        deadline_str = deadline.strftime("%Y-%m-%d %H:%M:%S")
        st.toast(
            f"""æ­å–œ{display_name}æ³¨å†ŒæˆåŠŸï¼ä¸ºç¡®ä¿æ‚¨èƒ½å°½å¿«ä½“éªŒæˆ‘ä»¬çš„æœåŠ¡ï¼Œè¯·äº{deadline_str}å‰å®Œæˆä»˜æ¬¾ã€‚"""
        )
        st.switch_page("pages/01_ğŸ’°_è®¢é˜….py")

    with st.expander("**æœåŠ¡æ¡æ¬¾**", expanded=False):
        st.markdown(
            """
        **æœåŠ¡æ¡æ¬¾**

**1. æœåŠ¡æ¦‚è¿°**

**è‹±è¯­åº”ç”¨èƒ½åŠ›æå‡åº”ç”¨æœåŠ¡æ¡æ¬¾**

**1. æœåŠ¡æ¦‚è¿°**

`Gaietu` [è‹±è¯­é€Ÿå­¦] appï¼ˆä»¥ä¸‹ç®€ç§°â€œæœ¬åº”ç”¨â€ï¼‰æ˜¯ç”± DF studio æä¾›çš„ä¸€ç§ä½¿ç”¨å¤§å‹ç”Ÿæˆå¼è¯­è¨€æ¨¡å‹ä½œä¸ºæ•™å­¦è¾…åŠ©å·¥å…·ï¼Œå¸®åŠ©ç”¨æˆ·æå‡è‹±è¯­åº”ç”¨èƒ½åŠ›çš„æœåŠ¡ã€‚æœ¬åº”ç”¨åŸºäºäº’è”ç½‘ï¼Œä¸ºç”¨æˆ·æä¾›ä¸°å¯Œçš„å­¦ä¹ èµ„æºå’Œäº’åŠ¨åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨è‹±è¯­åº”ç”¨èƒ½åŠ›å„æ–¹é¢å–å¾—æå‡ã€‚æœ¬åº”ç”¨çš„ç›®æ ‡ç”¨æˆ·æ˜¯å…·æœ‰ä¸€å®šè‹±è¯­åŸºç¡€ï¼Œå¸Œæœ›æå‡è‹±è¯­åº”ç”¨èƒ½åŠ›çš„ç”¨æˆ·ã€‚

**2. æœåŠ¡ä½¿ç”¨æ¡ä»¶**

ä½¿ç”¨æœ¬åº”ç”¨ï¼Œç”¨æˆ·éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

* å¹´æ»¡ 12 å‘¨å²ï¼Œä¸”å…·æœ‰è‡ªä¸»è¡Œä¸ºèƒ½åŠ›ã€‚
* å…·æœ‰æ­£å¸¸çš„é˜…è¯»ã€å¬åŠ›ã€å£è¯­èƒ½åŠ›ã€‚
* åº”å…·æœ‰è‰¯å¥½çš„ç½‘ç»œç¯å¢ƒï¼Œèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨æœ¬åº”ç”¨çš„åŠŸèƒ½ã€‚
* ç†Ÿç»ƒæŒæ¡ç”µè„‘ä¸Šç½‘æµè§ˆåŸºæœ¬æ“ä½œã€‚
* é…å¤‡éº¦å…‹é£ã€è€³æœºç¡¬ä»¶ï¼Œå¯æ­£å¸¸æ”¶å¬éŸ³é¢‘ã€å½•éŸ³ã€‚
* åŒæ„éµå®ˆæœ¬æœåŠ¡æ¡æ¬¾ã€‚

**3. æœåŠ¡è´¹ç”¨**

* æœ¬åº”ç”¨ä¸æä¾›è¯•ç”¨æœåŠ¡ã€‚
* å­¦ä¹ ç±»åŠŸèƒ½å®è¡ŒæœŸé™è®¢é˜…ï¼Œç”¨æˆ·å¯æ ¹æ®è‡ªèº«éœ€æ±‚é€‰æ‹©è®¢é˜…å‘¨æœŸã€‚è®¢é˜…å‘¨æœŸä¸º 1 å‘¨ã€ 1 ä¸ªæœˆã€3 ä¸ªæœˆã€6 ä¸ªæœˆã€1 å¹´ã€‚
* èŠå¤©æœºå™¨äººã€è¯„ä¼°ç±»åŠŸèƒ½å®ç°é™æ—¶æŒ‰æ¬¡ä»˜è´¹ï¼Œç”¨æˆ·å¯æ ¹æ®è‡ªèº«éœ€è¦é€‰æ‹©ä»˜è´¹æ¬¡æ•°ã€‚
* è®¢é˜…æœŸå†…ï¼Œç”¨æˆ·å¯æ— é™æ¬¡ä½¿ç”¨å­¦ä¹ ç±»åŠŸèƒ½ï¼Œä½†èŠå¤©æœºå™¨äººã€è¯„ä¼°ç±»åŠŸèƒ½çš„ä½¿ç”¨æ¬¡æ•°æ ¹æ®ç”¨æˆ·è´­ä¹°çš„æ¬¡æ•°é™åˆ¶ã€‚

å…·ä½“ä»·æ ¼è¡¨å¯åœ¨æœ¬åº”ç”¨çš„ç½‘ç«™æŸ¥è¯¢ã€‚

**4. æœåŠ¡å˜æ›´**

DF studio æœ‰æƒå¯¹æœ¬åº”ç”¨çš„æœåŠ¡å†…å®¹ã€æœåŠ¡è´¹ç”¨ã€æœåŠ¡æ¡æ¬¾ç­‰è¿›è¡Œå˜æ›´ã€‚ç”¨æˆ·åœ¨æ³¨å†Œæœ¬åº”ç”¨æ—¶ï¼Œéœ€é˜…è¯»å¹¶åŒæ„ã€ŠæœåŠ¡æ¡æ¬¾ã€‹ã€‚ç”¨æˆ·åœ¨å˜æ›´åç»§ç»­ä½¿ç”¨æœ¬åº”ç”¨ï¼Œè§†ä¸ºåŒæ„æ¥å—å˜æ›´åçš„æœåŠ¡å†…å®¹ã€æœåŠ¡è´¹ç”¨ã€‚
DF studio æœ‰æƒåœ¨åˆç†èŒƒå›´å†…å¯¹æœ¬æœåŠ¡æ¡æ¬¾è¿›è¡Œå˜æ›´ï¼Œå˜æ›´åçš„æœåŠ¡æ¡æ¬¾å°†åœ¨æœ¬åº”ç”¨çš„å®˜æ–¹ç½‘ç«™æˆ–å…¶ä»–é€‚å½“æ¸ é“å‘å¸ƒï¼Œç”¨æˆ·åœ¨å˜æ›´åç»§ç»­ä½¿ç”¨æœ¬åº”ç”¨ï¼Œè§†ä¸ºåŒæ„æ¥å—å˜æ›´åçš„æœåŠ¡æ¡æ¬¾ã€‚

**5. å…è´£å£°æ˜**

DF studio å¯¹æœ¬åº”ç”¨çš„ä½¿ç”¨ä¸æä¾›ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„æ‹…ä¿ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå¯¹æœ¬åº”ç”¨çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§ã€åŠæ—¶æ€§ã€å®‰å…¨æ€§ã€å¯é æ€§ç­‰ã€‚

DF studio å¯¹ç”¨æˆ·ä½¿ç”¨æœ¬åº”ç”¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä»»ä½•æŸå¤±ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç›´æ¥æŸå¤±ã€é—´æ¥æŸå¤±ã€é™„å¸¦æŸå¤±ã€è¡ç”ŸæŸå¤±ç­‰ï¼Œä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚

**6. äº‰è®®è§£å†³**

æœ¬æœåŠ¡æ¡æ¬¾çš„è§£é‡Šå’Œæ‰§è¡Œï¼Œé€‚ç”¨ä¸­åäººæ°‘å…±å’Œå›½æ³•å¾‹ã€‚

å› æœ¬æœåŠ¡æ¡æ¬¾å¼•èµ·çš„ä»»ä½•äº‰è®®ï¼Œç”± DF studio ä¸ç”¨æˆ·å‹å¥½åå•†è§£å†³ã€‚åå•†ä¸æˆçš„ï¼Œä»»ä½•ä¸€æ–¹å‡å¯å‘ä»²è£æœºæ„æèµ·ä»²è£ã€‚ä»²è£è£å†³æ˜¯ç»ˆå±€çš„ï¼Œå¯¹åŒæ–¹å‡å…·æœ‰çº¦æŸåŠ›ã€‚

**7. å…¶ä»–**

* **éšç§æ”¿ç­–**

ç¬¬ 1 æ¡ ç”¨æˆ·ä¸ªäººä¿¡æ¯ä¿æŠ¤ç”¨æˆ·æœ‰æƒæŸ¥é˜…ã€ä¿®æ”¹æˆ–åˆ é™¤å…¶ä¸ªäººä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æœ¬åº”ç”¨çš„â€œç”¨æˆ·ä¸­å¿ƒâ€åŠŸèƒ½è¿›è¡Œæ“ä½œã€‚

**ç¬¬ 2 æ¡ ç”¨æˆ·ä¸ªäººä¿¡æ¯ä¿æŠ¤**

DF Studio å°Šé‡ç”¨æˆ·çš„éšç§æƒï¼Œä¼šé‡‡å–ä¸€åˆ‡åˆç†çš„æªæ–½ä¿æŠ¤ç”¨æˆ·çš„éšç§ã€‚

**8. æœåŠ¡ä¸­æ–­æˆ–æ•…éšœ**

DF Studio ä¸å¯¹å› ä»¥ä¸‹åŸå› å¯¼è‡´çš„æœåŠ¡ä¸­æ–­æˆ–æ•…éšœæ‰¿æ‹…è´£ä»»ï¼š

- å› ä¸å¯æŠ—åŠ›æˆ–å…¶ä»–æ— æ³•æ§åˆ¶çš„åŸå› ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè‡ªç„¶ç¾å®³ï¼ˆå¦‚æ´ªæ°´ã€åœ°éœ‡ï¼‰ã€æ”¿åºœè¡Œä¸ºã€æˆ˜äº‰ã€ç«ç¾ã€ç½‘ç»œæ”»å‡»ã€é»‘å®¢è¡Œä¸ºã€ç”µåŠ›ä¸­æ–­ç­‰ï¼›
- å› ç”¨æˆ·çš„è®¾å¤‡ã€ç½‘ç»œç¯å¢ƒã€æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç­‰è½¯ç¡¬ä»¶ç¯å¢ƒä¸ç¬¦åˆæœ¬åº”ç”¨çš„ä½¿ç”¨è¦æ±‚ï¼Œæˆ–ç”¨æˆ·çš„è®¾å¤‡è¢«ç—…æ¯’ã€æœ¨é©¬æˆ–æ¶æ„ç¨‹åºæ”»å‡»ï¼›
- å› ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚ç”µä¿¡è¿è¥å•†ï¼‰çš„æ•…éšœæˆ–æœåŠ¡ä¸­æ–­ï¼›
- åœ¨å¿…è¦çš„ç»´æŠ¤æœŸé—´ï¼ŒDF Studio æœ‰æƒæš‚æ—¶åœæ­¢æä¾›æœåŠ¡ï¼ŒDF Studio å°†å°½å¯èƒ½æå‰é€šçŸ¥ç”¨æˆ·ã€‚

åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒDF Studio å¯¹ç”±äºæœåŠ¡ä¸­æ–­æˆ–æ•…éšœå¯¼è‡´çš„ä»»ä½•ç›´æ¥ã€é—´æ¥ã€é™„å¸¦ã€ç‰¹æ®Šã€æƒ©ç½šæ€§æˆ–åæœæ€§æŸå®³ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºåˆ©æ¶¦æŸå¤±ã€ä¸šåŠ¡ä¸­æ–­ã€æ•°æ®ä¸¢å¤±æˆ–å…¶ä»–ç»æµæŸå¤±ï¼‰ä¸æ‰¿æ‹…è´£ä»»ã€‚

**(ä¸€) ç”¨æˆ·ä¸ªäººä¿¡æ¯çš„æ”¶é›†**

æ³¨å†Œæœ¬åº”ç”¨æ—¶ï¼ŒDF Studio ä¼šæ”¶é›†ç”¨æˆ·çš„ä»¥ä¸‹ä¸ªäººä¿¡æ¯ï¼š

* ç”¨æˆ·å
* ä¸ªäººå¯†ç 
* çœŸå®å§“å
* æ‰‹æœºå·ç 
* ä¸ªäººé‚®ç®±
* å½“å‰è‹±è¯­æ°´å¹³
* æœŸæœ›è¾¾åˆ°çš„è‹±è¯­æ°´å¹³
* æ‰€åœ¨å›½å®¶
* æ‰€åœ¨çœä»½
* æ‰€åœ¨æ—¶åŒº

**(äºŒ) ç”¨æˆ·ä¸ªäººä¿¡æ¯çš„ä½¿ç”¨**

DF Studio ä¼šå°†ç”¨æˆ·ä¸ªäººä¿¡æ¯ç”¨äºä»¥ä¸‹ç›®çš„ï¼š

* æä¾›æœ¬åº”ç”¨çš„æœåŠ¡ï¼šDF Studio ä¼šä½¿ç”¨ç”¨æˆ·ä¸ªäººä¿¡æ¯æ¥æä¾›æœ¬åº”ç”¨çš„åŸºç¡€åŠŸèƒ½ï¼Œä¾‹å¦‚ç”¨æˆ·ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯å±•ç¤ºç­‰ã€‚
* æ”¹å–„æœ¬åº”ç”¨çš„æœåŠ¡ï¼šDF Studio ä¼šä½¿ç”¨ç”¨æˆ·ä¸ªäººä¿¡æ¯æ¥åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œä»¥æ”¹è¿›æœ¬åº”ç”¨çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚
* å‘ç”¨æˆ·å‘é€æœåŠ¡å‡çº§ä¿¡æ¯ï¼šDF Studio ä¼šä½¿ç”¨ç”¨æˆ·ä¸ªäººä¿¡æ¯æ¥å‘ç”¨æˆ·å‘é€æœåŠ¡å‡çº§ä¿¡æ¯ï¼Œä¾‹å¦‚æ–°åŠŸèƒ½ä»‹ç»ã€å®‰å…¨å…¬å‘Šç­‰

**(ä¸‰) ç”¨æˆ·ä¸ªäººä¿¡æ¯çš„å®‰å…¨**

DF Studio ä¼šé‡‡å–ä»¥ä¸‹æªæ–½ä¿æŠ¤ç”¨æˆ·ä¸ªäººä¿¡æ¯çš„å®‰å…¨ï¼š

* é™¤ç”¨æˆ·æ‰‹æœºå·ç å¤–ï¼Œæ‰€æœ‰ä¸ªäººéšç§ä¿¡æ¯å‡é‡‡ç”¨å®‰å…¨åŠ å¯†ç®—æ³•å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä»…å¯¹åº”ç”¨ç¨‹åºæœåŠ¡å™¨å¯è®¿é—®ã€‚
* åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä½¿ç”¨è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰æ¥é™åˆ¶å¯¹ä¸ªäººéšç§ä¿¡æ¯çš„è®¿é—®ï¼Œåªæœ‰ç³»ç»Ÿç®¡ç†å‘˜æ‰æœ‰æƒæŸ¥çœ‹ã€‚
* ç”¨æˆ·å¯†ç é‡‡ç”¨åŠ å¯†æŠ€æœ¯ï¼Œæœ‰æ•ˆä¿æŠ¤ç”¨æˆ·å¯†ç çš„å®‰å…¨ï¼Œå³ä½¿ DF Studio å‘˜å·¥ä¹Ÿä¸å¯èƒ½è·å¾—ç”¨æˆ·å¯†ç ã€‚

| é¡¹ç›® | åŠ å¯†å­˜å‚¨ | æ˜æ–‡å­˜å‚¨ | æƒé™ | è¯´æ˜ |
|---|:-:|:-:|---|---|
| ç”¨æˆ·å | å¦ | æ˜¯ | ä¸é™ | ç”¨äºåœ¨appæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„åç§° |
| ä¸ªäººå¯†ç  | æ˜¯ | å¦ | ä»…ç”¨æˆ·å¯è§ | ç”¨äºç™»å½•åº”ç”¨ç¨‹åº |
| çœŸå®å§“å | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |
| æ‰‹æœºå·ç  | å¦ | æ˜¯ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ |appäº¤äº’|
| çœŸå®å§“å | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |
| ä¸ªäººé‚®ç®± | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |
| æ‰€åœ¨å›½å®¶ | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |
| æ‰€åœ¨çœä»½ | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |
| æ‰€åœ¨æ—¶åŒº | æ˜¯ | å¦ | ä»…ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å¯è§ | ä¸ªäººéšç§ä¿¡æ¯ |

* **æ•°æ®ä½¿ç”¨**

DF studio å¯èƒ½ä¼šä½¿ç”¨ç”¨æˆ·çš„æ•°æ®æ¥æä¾›æœ¬åº”ç”¨çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

> * ä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„å­¦ä¹ å†…å®¹å’Œæ¨èã€‚
> * åˆ†æç”¨æˆ·çš„ä½¿ç”¨è¡Œä¸ºï¼Œä»¥æ”¹è¿›æœ¬åº”ç”¨çš„æœåŠ¡ã€‚

ç”¨æˆ·æœ‰æƒè¦æ±‚DF studio åˆ é™¤å…¶æ•°æ®ã€‚

* **ä½¿ç”¨èŠå¤©æœºå™¨äºº**
> * èŠå¤©æœºå™¨äººä½¿ç”¨çš„æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œå…·æœ‰ä¸€å®šçš„å­¦ä¹ å’Œç”Ÿæˆèƒ½åŠ›ï¼Œç”¨æˆ·åº”å¯¹å…¶åŠŸèƒ½å’Œå±€é™æ€§æœ‰æ­£ç¡®çš„è®¤è¯†ï¼Œé¿å…ä½¿ç”¨èŠå¤©æœºå™¨äººè¿›è¡Œä»»ä½•è¿æ³•æˆ–æœ‰å®³çš„è¡Œä¸ºï¼Œå¹¶å¯¹èŠå¤©æœºå™¨äººç”Ÿæˆçš„ä¿¡æ¯è¿›è¡Œåˆç†çš„åˆ¤æ–­å’Œè¯„ä¼°ã€‚
> * ç”¨æˆ·ä¸å¾—ä½¿ç”¨æœ¬åº”ç”¨ç”Ÿæˆä»»ä½•è™šå‡æˆ–è¯¯å¯¼æ€§ã€ä¾µçŠ¯ä»–äººæƒåˆ©æˆ–åˆ©ç›Šã€å…·æœ‰æ­§è§†æ€§æˆ–ä»‡æ¨æ€§ã€å…·æœ‰å±é™©æ€§æˆ–ç ´åæ€§çš„ä¿¡æ¯ã€‚
> * ç”¨æˆ·åœ¨ä½¿ç”¨æœ¬åº”ç”¨çš„èŠå¤©æœºå™¨äººæ—¶ï¼Œä¸å¾—å‘è¡¨ä»¥ä¸‹å†…å®¹ï¼š

>>> - å…³äºæ”¿æ²»äººç‰©çš„è´Ÿé¢è¨€è®ºï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè¯½è°¤ã€æ±¡è”‘ã€é€ è°£ç­‰ã€‚
>>> - ä¼ æ’­å®—æ•™æç«¯ä¸»ä¹‰æ€æƒ³ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå®£æ‰¬æš´åŠ›ã€ææ€–ã€åˆ†è£‚ç­‰ã€‚
>>> - ä¼ æ’­è‰²æƒ…ã€æš´åŠ›ç­‰è¿æ³•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ·«ç§½ã€è‰²æƒ…ã€æš´åŠ›ã€ææ€–ç­‰ã€‚
>>> - å®£ä¼ éæ³•é›†èµ„ã€ä¼ é”€ç­‰è¿æ³•æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºéæ³•é›†èµ„ã€ä¼ é”€ã€è¯ˆéª—ç­‰ã€‚

> * ç”¨æˆ·ä¸å¾—ä½¿ç”¨èŠå¤©æœºå™¨äººè¿›è¡Œä»¥ä¸‹æ´»åŠ¨ï¼š

>>> - å‘å¸ƒã€ä¼ æ’­ä»»ä½•è¿åå›½å®¶æ³•å¾‹æ³•è§„ã€æ”¿ç­–çš„å†…å®¹ã€‚
>>> - ä½¿ç”¨æœ¬åº”ç”¨ç”Ÿæˆä»»ä½•å…·æœ‰æ­§è§†æ€§æˆ–ä»‡æ¨æ€§çš„ä¿¡æ¯ã€‚
>>> - å‘å¸ƒã€ä¼ æ’­ä¸Šè¿°å†…å®¹ã€‚
>>> - ä¸ä»–äººè¿›è¡Œä¸Šè¿°å†…å®¹çš„è®¨è®ºã€‚

> **è¿åä¸Šè¿°è§„å®šçš„ï¼Œç”¨æˆ·å°†æ‰¿æ‹…ç›¸åº”çš„æ³•å¾‹è´£ä»»ã€‚**
"""
        )

    # region ç¾éŸ³ç¤ºä¾‹
    st.subheader(":headphones: é€‰æ‹©è¯­éŸ³é£æ ¼", divider="rainbow", anchor="è¯­éŸ³ç¤ºä¾‹")
    with st.expander(":headphones: è¯­éŸ³ç¤ºä¾‹", expanded=False):
        st.markdown(
            """
    ä»¥ä¸‹æ˜¯ï¼ˆç¾å›½ã€è‹±å›½ï¼‰å‘éŸ³ç¤ºä¾‹ï¼Œç‚¹å‡»æŒ‰é’®å³å¯æ’­æ”¾éŸ³é¢‘ã€‚
            
    - æ¼”ç¤ºæ–‡æœ¬è‹±æ–‡å†…å®¹ï¼š
    >>> My name is Li Ming. I am from China. I am a student at Peking University. I am majoring in computer science. I am interested in artificial intelligence and machine learning. I am excited to be here today and I look forward to meeting all of you.

    - æ¼”ç¤ºæ–‡æœ¬ä¸­æ–‡ç¿»è¯‘ï¼š
    >>> æˆ‘å«ææ˜ï¼Œæ¥è‡ªä¸­å›½ã€‚æˆ‘åœ¨åŒ—äº¬å¤§å­¦å­¦ä¹ ï¼Œä¸»ä¿®è®¡ç®—æœºç§‘å­¦ã€‚æˆ‘å¯¹äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ éå¸¸æ„Ÿå…´è¶£ã€‚æˆ‘å¾ˆé«˜å…´ä»Šå¤©èƒ½æ¥åˆ°è¿™é‡Œï¼ŒæœŸå¾…ä¸å¤§å®¶è§é¢ã€‚
            """
        )
        wav_files = list((VOICES_DIR / "us").glob("*.wav")) + list(
            (VOICES_DIR / "gb").glob("*.wav")
        )
        cols = st.columns(3)
        # åœ¨æ¯åˆ—ä¸­æ·»åŠ éŸ³é¢‘æ–‡ä»¶
        for i, wav_file in enumerate(wav_files):
            # è·å–æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰
            file_name = wav_file.stem
            # åœ¨åˆ—ä¸­æ·»åŠ æ–‡æœ¬å’ŒéŸ³é¢‘
            cols[i % 3].markdown(file_name)
            cols[i % 3].audio(str(wav_file))
        # voice_options = [
        #     "-".join(wav_file.stem.split("-")[:-1]) for wav_file in wav_files
        # ]
        # selected_voice = st.radio("é€‰æ‹©è¯­éŸ³é£æ ¼", voice_options)

        # if selected_voice:
        #     selected_voice_file = next(
        #         (wav_file for wav_file in wav_files if selected_voice in wav_file.stem),
        #         None,
        #     )
        #     if selected_voice_file:
        #         st.audio(str(selected_voice_file))

    with st.expander(
        "**CEFRï¼ˆæ¬§æ´²å…±åŒè¯­è¨€å‚è€ƒæ ‡å‡†ï¼‰è¯­è¨€èƒ½åŠ›åˆ†çº§æ ‡å‡†**", expanded=False
    ):
        st.markdown(
            """\
- A1ï¼šå…¥é—¨çº§

- èƒ½å¤Ÿç†è§£å¹¶è¿ç”¨ä¸è‡ªå·±æœ€åˆ‡èº«ç›¸å…³ä¸”ç»å¸¸ä½¿ç”¨çš„è¡¨è¾¾æ–¹å¼å’Œéå¸¸ç®€å•çš„è¯­å¥ï¼Œä¾‹å¦‚ï¼šä¸ªäººçš„å§“åã€å®¶åº­æˆå‘˜ã€åŸºæœ¬æ—¥å¸¸æ´»åŠ¨ã€è´­ç‰©ç­‰ã€‚
- èƒ½å¤Ÿç”¨ç®€å•çš„å¥å­ä¸ä»–äººè¿›è¡Œç®€å•çš„äº¤æµï¼Œä¾‹å¦‚ï¼šä»‹ç»è‡ªå·±ã€è¯¢é—®å’Œå›ç­”æœ‰å…³ä¸ªäººçš„ä¿¡æ¯ç­‰ã€‚

- A2ï¼šåˆçº§

- èƒ½å¤Ÿç†è§£å¹¶è¿ç”¨æ—¥å¸¸ç”Ÿæ´»ä¸­ç»å¸¸ä½¿ç”¨çš„è¡¨è¾¾æ–¹å¼å’Œç®€å•çš„è¯­å¥ï¼Œä¾‹å¦‚ï¼šåŸºæœ¬ä¸ªäººå’Œå®¶åº­ä¿¡æ¯ã€è´­ç‰©ã€åœ°ç†ä½ç½®ã€å°±ä¸šç­‰ã€‚
- èƒ½å¤Ÿç”¨ç®€å•çš„å¥å­è¡¨è¾¾ä¸ªäººçš„éœ€è¦ã€æƒ³æ³•å’Œæ„Ÿå—ï¼Œä¾‹å¦‚ï¼šä»‹ç»è‡ªå·±çš„å…´è¶£çˆ±å¥½ã€è°ˆè®ºè‡ªå·±çš„è®¡åˆ’ç­‰ã€‚

- B1ï¼šä¸­çº§

- èƒ½å¤Ÿç†è§£æ—¥å¸¸ç”Ÿæ´»ä¸­å¸¸è§çš„å£å¤´å’Œä¹¦é¢ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå·¥ä½œã€å­¦ä¹ ã€ä¼‘é—²ç­‰æ–¹é¢çš„ä¿¡æ¯ã€‚
- èƒ½å¤Ÿç”¨ç®€å•çš„å¥å­å’Œè¯­æ®µè¡¨è¾¾æ—¥å¸¸ç”Ÿæ´»å’Œå·¥ä½œä¸­å¸¸è§çš„ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šæè¿°ä¸ªäººç»å†ã€è°ˆè®ºè‡ªå·±çš„è®¡åˆ’å’Œæ„¿æœ›ç­‰ã€‚

- B2ï¼šä¸­é«˜çº§

- èƒ½å¤Ÿç†è§£æ—¥å¸¸ç”Ÿæ´»ä¸­å’Œå·¥ä½œä¸­å¹¿æ³›çš„å£å¤´å’Œä¹¦é¢ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šæ–°é—»æŠ¥é“ã€æ•™è‚²è¯¾ç¨‹ã€ä¸“ä¸šæ–‡çŒ®ç­‰ã€‚
- èƒ½å¤Ÿç”¨æ¸…æ™°çš„å¥å­å’Œè¯­æ®µè¡¨è¾¾å¤æ‚çš„ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šè®¨è®ºè§‚ç‚¹ã€åˆ†æé—®é¢˜ç­‰ã€‚

- C1ï¼šé«˜çº§

- èƒ½å¤Ÿç†è§£å¤æ‚çš„å£å¤´å’Œä¹¦é¢ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šé•¿ç¯‡æ–‡ç« ã€ä¸“ä¸šæ–‡çŒ®ç­‰ã€‚
- èƒ½å¤Ÿç”¨æµåˆ©ã€å‡†ç¡®çš„è¯­è¨€è¡¨è¾¾å¤æ‚çš„ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šåˆ†æã€æ‰¹è¯„ã€æ€»ç»“ç­‰ã€‚

- C2ï¼šç†Ÿç»ƒçº§

- èƒ½å¤Ÿç†è§£ä»»ä½•å£å¤´å’Œä¹¦é¢ä¿¡æ¯ï¼Œæ— è®ºå…¶å¤æ‚ç¨‹åº¦å¦‚ä½•ã€‚
- èƒ½å¤Ÿç”¨æµåˆ©ã€å‡†ç¡®ã€è‡ªç„¶çš„è¯­è¨€è¡¨è¾¾ä»»ä½•ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šé˜è¿°è§‚ç‚¹ã€è¾©è®ºã€åˆ›ä½œç­‰ã€‚
"""
        )


# endregion
